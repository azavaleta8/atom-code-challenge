import{A as G,B as H,p as D,q as F,s as j,t as z,u as A,v as $,w as W,x as q,y as B}from"./chunk-3M7Q6G52.js";import{c as R,h as U}from"./chunk-PIPYUMYX.js";import{Ab as P,Bb as k,Cb as E,Db as O,Eb as L,Ma as s,Na as v,Wb as T,Xb as V,Zb as N,ab as b,ca as M,cb as l,d as h,db as C,gb as a,hb as c,ib as S,la as _,ma as y,mb as x,ob as f,pb as p,wb as d,yb as w,zb as I}from"./chunk-QMA53QPF.js";var g=class extends Error{};g.prototype.name="InvalidTokenError";function K(e){return decodeURIComponent(atob(e).replace(/(.)/g,(n,r)=>{let t=r.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function Q(e){let n=e.replace(/-/g,"+").replace(/_/g,"/");switch(n.length%4){case 0:break;case 2:n+="==";break;case 3:n+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return K(n)}catch{return atob(n)}}function J(e,n){if(typeof e!="string")throw new g("Invalid token specified: must be a string");n||(n={});let r=n.header===!0?0:1,t=e.split(".")[r];if(typeof t!="string")throw new g(`Invalid token specified: missing part #${r+1}`);let i;try{i=Q(t)}catch(o){throw new g(`Invalid token specified: invalid base64 for part #${r+1} (${o.message})`)}try{return JSON.parse(i)}catch(o){throw new g(`Invalid token specified: invalid json for part #${r+1} (${o.message})`)}}var X=e=>({display:e});function Y(e,n){if(e&1&&(a(0,"div",9),d(1),c()),e&2){let r=p();s(),w(" ",r.errorMsg," ")}}function Z(e,n){if(e&1&&(a(0,"button",10),d(1,"Iniciar Sesion"),c()),e&2){let r=p();l("disabled",!r.email)}}function ee(e,n){if(e&1&&(a(0,"button",10),d(1,"Registrarse"),c()),e&2){let r=p();l("disabled",!r.email)}}function te(e,n){if(e&1){let r=x();a(0,"div",11),f("click",function(){_(r);let i=p();return y(i.toggleRegister())}),a(1,"span"),d(2,"Registrate"),c()()}e&2&&C("display","flex")}function ie(e,n){if(e&1){let r=x();a(0,"div",11),f("click",function(){_(r);let i=p();return y(i.toggleRegister())}),a(1,"span"),d(2,"Iniciar Sesion"),c()()}e&2&&C("display","flex")}function ne(e,n){e&1&&(a(0,"div",12),S(1,"mat-spinner",13),c()),e&2&&(s(),l("diameter",150))}var he=(()=>{let n=class n{constructor(t,i){this.apiService=t,this.router=i,this.email="",this.error=!1,this.errorMsg="",this.loading=!1,this.register=!1,console.log("Login Component")}toggleRegister(){this.error=!1,this.register=!this.register}isValidEmail(t){return/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(t)&&t.length<=50}registerUser(t){return h(this,null,function*(){try{let i=yield this.apiService.post("users",t).toPromise();if(console.log("Registration successful",i),i&&i.payload)return;this.error=!0,this.errorMsg="Invalid response from server"}catch(i){throw console.error("Registration failed",i),i}})}onSubmit(){return h(this,null,function*(){try{if(this.loading=!0,this.error=!1,this.errorMsg="",!this.isValidEmail(this.email)){this.error=!0,this.errorMsg="Email or password invalid";return}let t={email:this.email};this.register&&(yield this.registerUser(t));let i=yield this.apiService.post("users/login",t).toPromise();if(console.log("Login successful",i),i&&i.payload){let o=i.payload.token,m=J(o);sessionStorage.setItem("token",o),sessionStorage.setItem("userId",m.id),sessionStorage.setItem("email",m.email),this.loading=!1,this.router.navigate(["/dashboard"])}else this.error=!0,this.errorMsg="Invalid response from server"}catch(t){console.error("Login failed",t),this.handleError(t)}finally{this.loading=!1}})}handleError(t){t.status===404?this.errorMsg="No data":t.status===401?this.errorMsg="Credenciales Inv\xE1lidas":t.status===409?this.errorMsg="User already registered logging in...":t.status===422?this.errorMsg="Unprocessable Entity":this.errorMsg="Unable to connect to server",this.error=!0,this.loading=!1}};n.\u0275fac=function(i){return new(i||n)(v(H),v(U))},n.\u0275cmp=M({type:n,selectors:[["app-login"]],standalone:!0,features:[E([]),O],decls:12,vars:10,consts:[[1,"container"],[1,"login-container"],[1,"title-header"],[1,"form-container",3,"ngSubmit","ngStyle"],["type","email","id","email","name","email","placeholder","Email","required","",3,"ngModelChange","ngModel"],["style","height: auto;",4,"ngIf"],["type","submit",3,"disabled",4,"ngIf"],["class","link",3,"display","click",4,"ngIf"],["class","spinner",4,"ngIf"],[2,"height","auto"],["type","submit",3,"disabled"],[1,"link",3,"click"],[1,"spinner"],["color","accent",3,"diameter"]],template:function(i,o){i&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),d(3," Bienvenido To do App "),c(),a(4,"form",3),f("ngSubmit",function(){return o.onSubmit()}),a(5,"input",4),k("ngModelChange",function(u){return P(o.email,u)||(o.email=u),u}),c(),b(6,Y,2,1,"div",5)(7,Z,2,1,"button",6)(8,ee,2,1,"button",6),c(),b(9,te,3,2,"div",7)(10,ie,3,2,"div",7)(11,ne,2,1,"div",8),c()()),i&2&&(s(4),l("ngStyle",L(8,X,o.loading?"none":"block")),s(),I("ngModel",o.email),s(),l("ngIf",o.error),s(),l("ngIf",!o.register),s(),l("ngIf",o.register),s(),l("ngIf",!o.loading&&!o.register),s(),l("ngIf",!o.loading&&o.register),s(),l("ngIf",o.loading))},dependencies:[N,T,V,G,q,j,z,A,B,W,$,R,F,D],styles:[".login-container[_ngcontent-%COMP%]{margin:auto;background:#282c34;border-radius:20px;border:3px solid #282c34;min-width:500px;color:#fff}.login-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:30px auto auto;width:90%}.title[_ngcontent-%COMP%]{height:auto;text-align:center;font-size:25px;font-family:monospace}.title-header[_ngcontent-%COMP%]{height:auto;text-align:center;font-size:30px;font-weight:700;font-family:monospace}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:auto auto 30px;width:100%;height:50px;font-size:20px;font-family:monospace}input[_ngcontent-%COMP%]{box-sizing:border-box;padding-left:15px;border-color:#282c34;color:#282c34;border-radius:10px}button[_ngcontent-%COMP%]{border:none;background-color:#2e77ff;color:#fff;border-radius:10px;margin-bottom:10px!important}.link[_ngcontent-%COMP%]{cursor:pointer;margin:auto auto 20px;height:50px;font-size:20px;font-family:monospace;margin-top:0!important;text-align:center}span[_ngcontent-%COMP%]{margin:auto}button[_ngcontent-%COMP%]:disabled{background-color:gray;opacity:50%}button[_ngcontent-%COMP%]:hover{opacity:80%}.spinner[_ngcontent-%COMP%]{display:flex}.spinner[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:auto auto 20px}"]});let e=n;return e})();export{he as LoginComponent};
